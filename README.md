# `AI Tales - Backend Server`
Unlock creativity through the power of AI.

![AI Tales](https://github.com/soyrvelez/ai-tales/blob/main/ai-tales.png?sanitize=true)

## What is it?

This MERN app allows users to create illustrated stories using generative AI technology.

By leveraging the OpenAI API, AI Tales is able to take user input to create an interactive storytelling experience.

AI Tales allows users to:
* Create an account.
* Create characters with custom traits.
* Create short stories based on user prompts.
* Use DALL-E 3 to generate images inspired by these stories.
* Access their user profile for the app.
* Modify their account details.
* Delete their user account.
* Visualize content they have created.
* Explore content generated by other users.

> Looking for the app's frontend? Go to its [Github Repo](https://github.com/soyrvelez/ai-tales).


## Installation Instructions
1. Fork and clone this repository.
2. Run `npm install` from your terminal while inside of the project's directory.
3. Set up a `.env` file and add the following:
  - `MONGO_URI`: URL to connect to your MongoDB database. Reference MongoDB's driver installation for Node.js for further instruction.
  - `OPENAI_API_KEY`: API Key for Open AI's API. You'll need one in order to use GPT and DALL-E in this app.
  - `JWT_SECRET`: Secret for authentication through JSON Web Tokens.
4. Recommended: Do an initial commit and push to your fork.
5. Run your backend server and run `npm run dev`.

## Navigating The Project
### Data Models
#### Entity Relationship Diagram
![ERD](https://github.com/soyrvelez/ai-tales/blob/main/ai-tales-erd.png?sanitize=true)

#### User Model
- **Description:** This model is used to store user information.
- **Attributes:**
  - **id:** Automatically generated by the ODM.
  - **username:** Any username selected by the user.
  - **email:** User's email.
  - **password:** User's password
  - **createdAt:** Automatically generated by the ODM.
  - **updatedAt:** Automatically generated by the ODM.

#### Character Model
- **Description:** This model is used to store character information.
- **Attributes:**
  - **id:** Automatically generated by the ODM.
  - **userId:** id corresponding to an id in the user's table. This tracks which user generated a character.
  - **name:** Character's name.
  - **species:** Users can type in any species including fictional ones.
  - **gender:** Users can type in any gender for their character.
  - **age:** Users can type in any age for their character.
  - **personality:** Users can describe their characters personality.
  - **favorite hobby:** Users can give their characters a hobby that will be represented in their scenes.
  - **createdAt:** Automatically generated by the ODM.
  - **updatedAt:** Automatically generated by the ODM.

  #### Scene Model
- **Description:** This model is used to store user generated scenes.
- **Attributes:**
  - **id:** Automatically generated by the ODM.
  - **character:** Character associated with the scene.
  - **prompt:** User input used to generate the short story and illustration to make up the scene.
  - **scene image URL:** URL provided by OpenAI's API for the scene's image.
  - **scene caption:** Caption provided by OpenAI's API as a short story for the scene.
  - **stats:** A collection of common social media engagement metrics: likes, comments, views.
  - **createdAt:** Automatically generated by the ODM.
  - **updatedAt:** Automatically generated by the ODM.

### API / Routes
#### Users
- POST - /new Create a user
- GET - /:id - View a single user
- PUT - - edit/:id - Edit user account
- DELETE - delete/:id - Delete user account

#### Characters
- POST - /new - Create a character
- GET - /:id - View a single character
- GET - /collection/:userId - Views all of a user’s characters
- PUT - /edit/:id - Edit a single character
- DELETE - /delete/:id - Delete character

#### Scene
- POST - /new/:characterId - Create a scene
- GET - /:id - View a single scene
- GET - /character/:characterId - Views all of a character’s scenes
- GET - /users/:userId - Views all of a user’s scenes
- GET - /explore/:userId - View all scenes generated by the current user
- GET - /explore/feed/:userId - Views all scenes except the ones generated by the current user

### Working with OpenAI's API
#### Text Completion
The app takes user input and utilizes it to complete a prompt that gets passed to OpenAI's GPT-4 Model in order to generate a short story that will then be used to inspire image generation by DALL-E 3.

```
async function getCaption(prompt, character) {
  try {
    const { name, species, gender, age, personality, favoriteHobby } = character;
    const response = await openai.chat.completions.create({
      model: "gpt-4",
      messages: [
        {
          "role": "system",
          "content": `Create a short story (2 paragraphs maximum length) based on a character named ${name}. ${name} is a ${gender} ${species} that is ${age} years old has a ${personality} personality and their favorite hobby is ${favoriteHobby}.

          You will use the prompt provided by the user as the inspiration for your story's plot. If the user's input deviates from your purpose, create a story based on the character's traits.`
        },
        {
          "role": "user",
          "content": prompt
        }
      ],
    });
    return response.choices[0].message.content;
  } catch (error) {
    console.error(error);
    return null;
  }
};
```
#### Image Generation
Using the response from calling the text completion API (GPT-4), we will then formulate an image generation request with DALL-E. This request pulls character traits stored in the database in order to attempt to keep some consistency between scenes generated for the same character, regardless of the details contained in the prompt provided by the user.

```
async function getAvatar(character) {
  try {
    const { name, species, gender, age, personality, favoriteHobby } = character;
    const response = await openai.images.generate({
      model: "dall-e-3",
      prompt: `Create a detailed and expressive headshot portrait in the style of a high-quality animated movie. Use bright, vivid colors and a joyful, wonder-filled atmosphere. The subject of the headshot is a ${age}-year-old ${gender} ${species} named ${name}, characterized by a ${personality} personality and a favorite hobby: ${favoriteHobby}. The image should be optimized to standout when used as a social media profile picture or avatar.`,
      n: 1,
      size: "1024x1024"
    });
    return response.data[0].url;
  } catch (error) {
    console.error(error);
    return null;
  }
};
```
#### Learnings & Opportunities

##### Learnings
- Handling authentication with JWT.
- Simplify development by following a test driven approach.
- Utilizing Mongoose to handle MongoDB queries and requests in our API.

##### Opportunities
- Experimenting with different image generation models ie., Stable Diffusion.
- Expanding the API to support more social features. ie., Adding Friends / Followers.

### Team
AI Tales was developed in partnership by:
- [Abigail Olaguivel](https://github.com/Abbyog27)
- [Layla Cervantes](https://github.com/ltcervan)
- [Rodrigo Vélez](https://github.com/soyrvelez/)
